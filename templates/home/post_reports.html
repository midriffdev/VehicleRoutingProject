{% extends 'home/base.html' %}
{% load static %}
{% block content %}

                
                
                <div class="container-fluid">

                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                <h4 class="mb-sm-0 font-size-18">All Reports</h4>

                                <div class="page-title-right">
                                    <!-- <button type="button" class="btn btn-primary btn-md waves-effect waves-light"
                                    data-bs-toggle="modal" data-bs-target=".view-routes-in-map">View Routes In Map
                                    </button> -->
                                </div>

                            </div>
                        </div>
                    </div>

                   
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card shadow-lg">
                                <div class="card-body py-4">


                                <form action="{% url 'post_reports' %}" method="post" enctype="multipart/form-data"
                                    class="d-flex align-items-end w-100">
                                    {% csrf_token %}



                                    <div class="row w-100">

                                        <div class="col-md-3">
                                            <label class="form-label text-dark-primary mb-2">Warehouse</label>
                                            <select name="wids" class="form-control select2" id="warehouseSelect">
                                                <option value="All_Warehouse" {% if wids == "All_Warehouse" %}selected{% endif %}>All Warehouse</option>
                                                {% for w in warehouses %}
                                                    <option value="{{ w.id }}" {% if wids == w.id %}selected{% endif %}>{{ w.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        
                                                <div class="col-md-3">
                                                    <label class="form-label text-dark-primary">Order Status</label>
                                                    <select name="selectedValueo" class="form-control select2">
                                                        <option value="All_orders" {% if orderstatus == "All_orders" %}selected{% endif %}>All</option>
                                                        <option value="delivered" {% if orderstatus == "delivered" %}selected{% endif %}>Delivered</option>
                                                        <option value="pending" {% if orderstatus == "pending" %}selected{% endif %}>Pending</option>
                                                        <option value="canceled" {% if orderstatus == "canceled" %}selected{% endif %}>Cancel</option>
                                                    </select>
                                                </div>

                                            
                                    
                                        <div class="col-md-6">
                                                <label class="text-dark-primary">Date</label>
                                                <div class="d-flex align-items-start">
                                                <div class="input-daterange input-group" id="datepicker5" data-date-format="dd M, yyyy" data-date-autoclose="true" data-provide="datepicker" data-date-container='#datepicker5'>
                                            <input type="text" value="{{ start_date }}" class="form-control" name="start_date" id="start" placeholder="Start Date" autocomplete="off" />
                                            <input type="text" value="{{ end_date }}" class="form-control" name="end_date" id="end" placeholder="End Date" autocomplete="off" /></div>
                                                <button type="submit" class="btn btn-md btn-secondary ms-1 text-nowrap">Apply Filter </button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                </div>
                            </div>

                        
                            <div class="row">
                                <div class="col-xl-3 col-md-6">
                                    <div class="card bg-primary bg-soft  rounded shadow-lg border border-primary">
                                        <div class="card-body py-4 loaderDiv ">
                                            <div class="d-flex flex-column align-items-center text-center">
                                                <div class="mb-4">
                                                    <svg width="50px" height="50px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M20.5 7.27783L12 12.0001M12 12.0001L3.49997 7.27783M12 12.0001L12 21.5001M14 20.889L12.777 21.5684C12.4934 21.726 12.3516 21.8047 12.2015 21.8356C12.0685 21.863 11.9315 21.863 11.7986 21.8356C11.6484 21.8047 11.5066 21.726 11.223 21.5684L3.82297 17.4573C3.52346 17.2909 3.37368 17.2077 3.26463 17.0893C3.16816 16.9847 3.09515 16.8606 3.05048 16.7254C3 16.5726 3 16.4013 3 16.0586V7.94153C3 7.59889 3 7.42757 3.05048 7.27477C3.09515 7.13959 3.16816 7.01551 3.26463 6.91082C3.37368 6.79248 3.52345 6.70928 3.82297 6.54288L11.223 2.43177C11.5066 2.27421 11.6484 2.19543 11.7986 2.16454C11.9315 2.13721 12.0685 2.13721 12.2015 2.16454C12.3516 2.19543 12.4934 2.27421 12.777 2.43177L20.177 6.54288C20.4766 6.70928 20.6263 6.79248 20.7354 6.91082C20.8318 7.01551 20.9049 7.13959 20.9495 7.27477C21 7.42757 21 7.59889 21 7.94153L21 12.5001M7.5 4.50008L16.5 9.50008M16 18.0001L18 20.0001L22 16.0001" stroke="#556ee6" stroke-width="0.8160000000000001" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <h4 id="warehouse_total_order" class="text-primary">{{warehouse_total_order}}</h4>
                                                    <p class="fw-medium font-size-13 text-primary">Total Orders </p>
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-md-6">
                                    <div class="card bg-warning bg-soft  rounded shadow-lg border border-warning">
                                        <div class="card-body py-4 loaderDiv ">
                                            <div class="d-flex flex-column align-items-center text-center">
                                                <div class="mb-4">
                                                    <svg fill="#f1b44c" height="50px" width="50px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" stroke="#000000" stroke-width="0.00512"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g transform="translate(1 1)"> <g> <g> <path d="M511,109.933C511,48.493,461.507-1,400.067-1c-58.568,0-106.28,44.975-110.612,102.4H255v-8.533 c0-5.12-3.413-8.533-8.533-8.533h-85.333c-5.12,0-8.533,3.413-8.533,8.533v8.533H41.667C17.773,101.4-1,120.173-1,144.067 v324.267C-1,492.227,18.627,511,41.667,511h324.267c23.893,0,42.667-18.773,42.667-42.667V220.546 C466.025,216.214,511,168.502,511,109.933z M169.667,101.4h68.267v8.533v84.48l-29.013-23.04 c-1.707-0.853-3.413-1.707-5.12-1.707c-1.707,0-3.413,0.853-5.12,1.707l-29.013,23.04v-84.48V101.4z M391.533,468.333 c0,14.507-11.093,25.6-25.6,25.6H41.667c-14.507,0-25.6-11.093-25.6-25.6V144.067c0-14.507,11.093-25.6,25.6-25.6H152.6v77.653 c0,5.973,3.413,11.947,9.387,14.507c1.707,0.853,4.267,1.707,6.827,1.707c3.413,0,6.827-0.853,10.24-3.413l24.747-19.627 l24.747,19.627c5.12,3.413,11.093,4.267,17.067,1.707c5.973-2.56,9.387-8.533,9.387-14.507v-77.653h34.133 c4.267,54.613,47.787,98.133,102.4,102.4V468.333z M400.067,203.8c-52.053,0-93.867-41.813-93.867-93.867 s41.813-93.867,93.867-93.867c52.053,0,93.867,41.813,93.867,93.867S452.12,203.8,400.067,203.8z"></path> <path d="M442.733,101.4H408.6V41.667c0-5.12-3.413-8.533-8.533-8.533c-5.12,0-8.533,3.413-8.533,8.533v68.267 c0,5.12,3.413,8.533,8.533,8.533h42.667c5.12,0,8.533-3.413,8.533-8.533S447.853,101.4,442.733,101.4z"></path> <path d="M178.2,357.4H58.733c-5.12,0-8.533,3.413-8.533,8.533v102.4c0,5.12,3.413,8.533,8.533,8.533H178.2 c5.12,0,8.533-3.413,8.533-8.533v-102.4C186.733,360.813,183.32,357.4,178.2,357.4z M169.667,459.8h-102.4v-85.333h102.4V459.8z"></path> <path d="M92.867,408.6h51.2c5.12,0,8.533-3.413,8.533-8.533c0-5.12-3.413-8.533-8.533-8.533h-51.2 c-5.12,0-8.533,3.413-8.533,8.533C84.333,405.187,87.747,408.6,92.867,408.6z"></path> <path d="M92.867,442.733H127c5.12,0,8.533-3.413,8.533-8.533s-3.413-8.533-8.533-8.533H92.867c-5.12,0-8.533,3.413-8.533,8.533 S87.747,442.733,92.867,442.733z"></path> </g> </g> </g> </g></svg>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <h4 id="warehouse_pending_order" class="text-warning">{{warehouse_pending_order}}</h4>
                                                    <p class="fw-medium font-size-13 text-warning">Pending Orders</p>
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-md-6">
                                    <div class="card bg-danger bg-soft  rounded shadow-lg border border-danger">
                                        <div class="card-body py-4 loaderDiv ">
                                            <div class="d-flex flex-column align-items-center text-center">
                                                <div class="mb-4">
                                                    <svg fill="#f46a6a" height="50px" width="50px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g transform="translate(1 1)"> <g> <g> <path d="M511,109.933C511,48.493,461.507-1,400.067-1c-58.568,0-106.28,44.975-110.612,102.4H255v-8.533 c0-5.12-3.413-8.533-8.533-8.533h-85.333c-5.12,0-8.533,3.413-8.533,8.533v8.533H41.667C17.773,101.4-1,120.173-1,144.067 v324.267C-1,492.227,18.627,511,41.667,511h324.267c23.893,0,42.667-18.773,42.667-42.667V220.546 C466.025,216.214,511,168.502,511,109.933z M169.667,101.4h68.267v8.533v84.48l-29.013-23.04c-2.56-2.56-6.827-2.56-10.24,0 l-29.013,23.04v-84.48V101.4z M391.533,468.333c0,14.507-11.093,25.6-25.6,25.6H41.667c-14.507,0-25.6-11.093-25.6-25.6V144.067 c0-14.507,11.093-25.6,25.6-25.6H152.6v77.653c0,5.973,3.413,11.947,9.387,14.507c5.12,2.56,11.947,2.56,17.067-1.707 l24.747-19.627l24.747,19.627c3.413,2.56,6.827,3.413,10.24,3.413c2.56,0,5.12,0,6.827-1.707 c5.973-2.56,9.387-8.533,9.387-14.507v-77.653h34.133c4.267,54.613,47.787,98.133,102.4,102.4V468.333z M400.067,203.8 c-52.053,0-93.867-41.813-93.867-93.867s41.813-93.867,93.867-93.867c52.053,0,93.867,41.813,93.867,93.867 S452.12,203.8,400.067,203.8z"></path> <path d="M178.2,357.4H58.733c-5.12,0-8.533,3.413-8.533,8.533v102.4c0,5.12,3.413,8.533,8.533,8.533H178.2 c5.12,0,8.533-3.413,8.533-8.533v-102.4C186.733,360.813,183.32,357.4,178.2,357.4z M169.667,459.8h-102.4v-85.333h102.4V459.8z"></path> <path d="M92.867,408.6h51.2c5.12,0,8.533-3.413,8.533-8.533c0-5.12-3.413-8.533-8.533-8.533h-51.2 c-5.12,0-8.533,3.413-8.533,8.533C84.333,405.187,87.747,408.6,92.867,408.6z"></path> <path d="M92.867,442.733H127c5.12,0,8.533-3.413,8.533-8.533s-3.413-8.533-8.533-8.533H92.867c-5.12,0-8.533,3.413-8.533,8.533 S87.747,442.733,92.867,442.733z"></path> <path d="M448.707,61.293c-3.413-3.413-8.533-3.413-11.947,0l-36.693,36.693l-36.693-36.693c-3.413-3.413-8.533-3.413-11.947,0 c-3.413,3.413-3.413,8.533,0,11.947l36.693,36.693l-36.693,36.693c-3.413,3.413-3.413,8.533,0,11.947 c1.707,1.707,3.413,2.56,5.973,2.56s4.267-0.853,5.973-2.56l36.693-36.693l36.693,36.693c1.707,1.707,3.413,2.56,5.973,2.56 s4.267-0.853,5.973-2.56c3.413-3.413,3.413-8.533,0-11.947l-36.693-36.693l36.693-36.693 C452.12,69.827,452.12,64.707,448.707,61.293z"></path> </g> </g> </g> </g></svg>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <h4 class="text-danger">{{warehouse_cancel_order}}</h4>
                                                    <p class="fw-medium font-size-13 text-danger">Cancelled Orders</p>
                                                   

                                                    


                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-3 col-md-6">
                                    <div class="card bg-success bg-soft  rounded shadow-lg border border-success">
                                        <div class="card-body py-4 loaderDiv ">
                                            <div class="d-flex flex-column align-items-center text-center">
                                                <div class="mb-4">
                                                    <svg fill="#34c38f" height="50px" width="50px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" stroke="#000000" stroke-width="0.00512"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g transform="translate(1 1)"> <g> <g> <path d="M511,109.933C511,48.493,461.507-1,400.067-1c-58.568,0-106.28,44.975-110.612,102.4H255v-8.533 c0-5.12-3.413-8.533-8.533-8.533h-85.333c-5.12,0-8.533,3.413-8.533,8.533v8.533H41.667C17.773,101.4-1,120.173-1,144.067 v324.267C-1,492.227,18.627,511,41.667,511h324.267c23.893,0,42.667-18.773,42.667-42.667V220.546 C466.025,216.214,511,168.502,511,109.933z M169.667,101.4h68.267v8.533v84.48l-29.013-23.04c-2.56-2.56-6.827-2.56-10.24,0 l-29.013,23.04v-84.48V101.4z M391.533,468.333c0,14.507-11.093,25.6-25.6,25.6H41.667c-14.507,0-25.6-11.093-25.6-25.6V144.067 c0-14.507,11.093-25.6,25.6-25.6H152.6v77.653c0,5.973,3.413,11.947,9.387,14.507c5.12,2.56,11.947,2.56,17.067-1.707 l24.747-19.627l24.747,19.627c3.413,2.56,6.827,3.413,10.24,3.413c2.56,0,5.12,0,6.827-1.707 c5.973-2.56,9.387-8.533,9.387-14.507v-77.653h34.133c4.267,54.613,47.787,98.133,102.4,102.4V468.333z M400.067,203.8 c-52.053,0-93.867-41.813-93.867-93.867s41.813-93.867,93.867-93.867c52.053,0,93.867,41.813,93.867,93.867 S452.12,203.8,400.067,203.8z"></path> <path d="M455.533,60.44c-4.267-2.56-9.387-1.707-11.947,2.56l-53.76,84.48l-34.987-34.987c-3.413-3.413-8.533-3.413-11.947,0 c-3.413,3.413-3.413,8.533,0,11.947l42.667,42.667c1.707,1.707,3.413,2.56,5.973,2.56c0,0,0.853,0,0.853,0.853 c2.56-0.853,4.267-1.707,5.973-4.267l59.733-93.867C460.653,68.12,459.8,63,455.533,60.44z"></path> <path d="M178.2,357.4H58.733c-5.12,0-8.533,3.413-8.533,8.533v102.4c0,5.12,3.413,8.533,8.533,8.533H178.2 c5.12,0,8.533-3.413,8.533-8.533v-102.4C186.733,360.813,183.32,357.4,178.2,357.4z M169.667,459.8h-102.4v-85.333h102.4V459.8z"></path> <path d="M92.867,408.6h51.2c5.12,0,8.533-3.413,8.533-8.533c0-5.12-3.413-8.533-8.533-8.533h-51.2 c-5.12,0-8.533,3.413-8.533,8.533C84.333,405.187,87.747,408.6,92.867,408.6z"></path> <path d="M92.867,442.733H127c5.12,0,8.533-3.413,8.533-8.533s-3.413-8.533-8.533-8.533H92.867c-5.12,0-8.533,3.413-8.533,8.533 S87.747,442.733,92.867,442.733z"></path> </g> </g> </g> </g></svg>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <h4 id="warehouse_complete_order" class="text-success">{{warehouse_complete_order}}</h4>
                                                    <p class="text-success fw-medium font-size-13">Delivered Orders</p>
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="card shadow-lg">
                                <div class="card-body loaderDiv  ">
                                    <div class="d-flex flex-wrap">
                                        <h4 class="card-title text-dark-primary mb-4">Warehouse Stock Details</h4>
    
                                        <div class="ms-auto">
                                        </div>
                                    </div>
                                    <div class="table-responsive reportTable">
                                        <table class="table mb-0 table-bordered table-striped">
    
                                            <thead  class="table-light">
                                                <tr>
                                                    <th class="ps-2">Sr.no</th>
                                                    <th>Warehouse</th>
                                                    <th>Product Name</th>
                                                    <th class="ps-2">Total Stock</th>
                                                    <th class="ps-2">Dispatched Stock</th>
                                                    <th class="ps-2">Remaining Stock</th>
                                                    <th class="ps-2 text-center">Action</th>
                                                 
                                                </tr>
                                            </thead>
                                            <tbody >
                                                {% for warehouse in warehouses %}
                                                <tr> 
                                                    <td>{{ forloop.counter }}</td>
                                                    <td>{{warehouse.name}}</td>
                                                    <td>{{warehouse.product_name}}</td>
                                                    <td>{{warehouse.total_stock}}</td>
                                                    <td>{{warehouse.left_stock}}</td>
                                                    <td>{{warehouse.deliveredStck}}</td>
                                                    <td>
                                                        <div class="d-flex justify-content-center">
                                                            <a href="{% url 'headquarter' %}" class="btn btn-sm btn-secondary"><i class="bx bx-pencil me-1"></i> Raise Stock </a></td>
                                                        </div>
                                                </tr>
                                                {% endfor %}
                                                
                                            </tbody>
                                        </table>
                                    </div>
    
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        {% comment %} <div class="col-md-3">
                            <div class="card">
                                <div class="card-body py-4">
                                    
                                    <div class="mb-3">
                                        <label>Order Date</label>
    
                                        <div class="input-daterange input-group" id="datepicker6" data-date-format="dd M, yyyy" data-date-autoclose="true" data-provide="datepicker" data-date-container='#datepicker6'>
                                            <input onchange="alertSelectedValue()" id="order_startdate" type="text" class="form-control" name="order_startdate" placeholder="Start Date" />
                                            <input  onchange="alertSelectedValue()" id="order_enddate" type="text" class="form-control" name="order_enddate" placeholder="End Date" />
                                        </div>
                                    </div>
                                    <div>
                                        <button type="button" class="btn btn-md btn-secondary ms-1 text-nowrap">Apply Filter</button>
                                    </div>
                                </div>
                            </div> 
                            <div class="card  ">
                                <div class="card-body py-4">
                                    
                                </div>
                            </div> 
                        </div> {% endcomment %}

                        <div class="col-8">
                            
                                <div class="card shadow-lg">
                                    <div class="card-body loaderDiv ">
                                        <div class="d-flex flex-wrap">
                                            <h4 class="card-title text-dark-primary mb-4">Truck Delivery Efficiency</h4>
        
                                            <div class="ms-auto">
    
                                            </div>
                                        </div>
                                        <div id="bar_chart" class="apex-charts" dir="ltr"></div>
    
                                    </div>
                                </div>

                                <div class="card shadow-lg">
                                    <div class="card-body loaderDiv ">
                                        <div class="d-flex flex-wrap">
                                            <h4 class="card-title text-dark-primary mb-4">Route Optimization Metrics</h4>
        
                                            <div class="ms-auto">
                                            </div>
                                        </div>
                                        <div id="column_chart" class="apex-charts" dir="ltr"></div>
                                    </div>
                                </div>

                                <div class="card shadow-lg">
                                    <div class="card-body loaderDiv">
                                        <div class="d-flex flex-wrap">
    
                                            {% comment %} {% for truck_id, data in truck_loads.items %}
                                            <div>
                                                <h3>Truck {{ data.truck_name }}</h3>
                                                <p>Total Load: {{ data.total_load }} kg</p>
                                                <p>Capacity: {{ data.capacity }} kg</p>
                                                <p>Load Efficiency: {{ data.load_efficiency|floatformat:2 }}%</p>
                                            </div>
                                           {% endfor %} {% endcomment %}
    
    
    
                                            <h4 class="card-title text-dark-primary mb-4">Truck Efficiency  </h4>
    
                                          
        
                                            <div class="ms-auto">
                                            </div>
                                        </div>
                                        <div id="bar_chartEffe" class="apex-charts" dir="ltr"></div>
                                    </div>
                                </div>
                        </div>
                        <div class="col-4">
                            <div class="card shadow-lg border border-secondary">
                                <div class="card-body loaderDiv ">
                                    <div class="d-flex flex-wrap">
                                        <h4 class="card-title text-dark-primary mb-4 text-center d-block w-100">One Time Shipment</h4>
                                      
                                       
    
                                        <div class="ms-auto">
                                        </div>
                                    </div>

                                    <div>
                                        <div id="donut-chart" class="apex-charts"></div>
                                    </div>
                                    <div class="text-center text-muted">
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="mt-4">

                                                <form action="{% url 'post_reports' %}" method="post" enctype="multipart/form-data">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="wids" value="{{wids}}" />
                                                        <input type="hidden" name="start_date" value="{{start_date}}" />
                                                        <input type="hidden" name="end_date" value="{{end_date}}" />
                                                        <input type="hidden" name="orderstatus" value="{{orderstatus}}" />


                                                    <p class="mb-2 text-truncate">
                                                        <i class="mdi mdi-circle text-success me-1"></i> Within Time</p>
                                                    <h5 id="within_time">{{within_time}}</h5>
                                                    </a>
                                                    
                                                </form>



                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="mt-4">
                                                    <p class="mb-2 text-truncate">
                                                        <i class="mdi mdi-circle text-danger me-1"></i> Out Of Time</p>
                                                    <h5 id="out_of_time" >{{out_of_time}}</h5>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card shadow-lg border border-secondary">
                                <div class="card-body py-4 loaderDiv  ">
                                    <label class="form-label text-dark-primary mb-4 d-block text-center fw-bold">Sustainability and Emissions Metrics (Kg)</label>
                                    <div id="gauge-chart" class="e-charts mb-minus80" ></div>
                                </div>
                            </div>
                            <div class="card shadow-lg border border-secondary ">
                                <div class="card-body py-4 loaderDiv ">
                                    <label class="form-label text-dark-primary mb-4 d-block text-center fw-bold">Fuel Consumption(litre)</label>
                                    <div id="gauge-chart1" class="e-charts mb-minus80"></div>
                                </div>
                            </div>
                            <div class="card shadow-lg border border-secondary">
                                <div class="card-body py-4 loaderDiv ">
                                    <label class="form-label text-dark-primary mb-4 d-block text-center fw-bold">Fuel Savings(litre)</label>
                                    <div id="gauge-chart2" class="e-charts mb-minus80"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card shadow-lg">
                                <div class="card-body loaderDiv  ">
                                    <div class="d-flex flex-wrap">
                                        <h4 class="card-title text-dark-primary mb-4">Total Orders</h4>
    
                                        <div class="ms-auto">
                                        </div>
                                    </div>
                                    <div class="table-responsive reportTable">
                                        <table class="table mb-0 table-bordered table-striped">
    
                                            <thead  class="table-light">
                                                <tr>
                                                    <th class="ps-2">Sr.no</th>
                                                    <th>Product Name</th>
                                                   
                                                    <th class="ps-2">Customer</th>
                                                    <th class="ps-2">Qty</th>
                                                    <th class="ps-2">Destination</th>
                                                    <th class="ps-2">Status</th>
                                                    <th>Order Date</th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                {% if order_list%}
                                                    {% for order in order_list %}
                                                        <tr>
                                                            <td>{{forloop.counter}}</td> 
                                                            <td>{{order.product_name}}</td>
                                                           
                                                            <td>{{order.cname}}</td>
                                                            <td>{{order.quantity}}</td>
                                                            <td>{{order.destination}}</td>
                                                            <td>{{order.order_status}}</td>
                                                            <td>{{order.created_at}}</td>
                                                        </tr>
                                                    {% endfor %}
                                                {% else %}
                                                <p class='text-center p-2'>No orders yet</p>
                                                {% endif%}
                                                
                                            </tbody>
                                        </table>
                                    </div>
    
                                </div>
                            </div>
                        </div>
                    </div>






                    <div class="row">
                        <div class="col-md-12">
                            <div class="card shadow-lg">
                                <div class="card-body loaderDiv ">
                                    <div class="d-flex flex-wrap">
                                        <h4 class="card-title text-dark-primary mb-4">
                                            <!-- Feedback Detailsâ€”Delivered Orders -->
                                            Completed Orders
                                        </h4>
    
                                        <div class="ms-auto">
                                        </div>
                                    </div>
                                    <div class="table-responsive reportTable">
                                        <table class="table mb-0 table-bordered table-striped">
    
                                            <thead class="table-light">
                                                <tr>
                                                    <th> Order Number </th>
                                                    <th> Product Name</th>
                                                    <th class="ps-2">Customer Name</th>
                                                    <th class="ps-2">Rating</th>
                                                    <th class="ps-2">Feedback</th>
                                                    <th class="ps-2">Order Date</th>
                                                </tr>
                                            </thead>
                                            {% if order_list %}
                                                {% for order in order_list %}
                                         

                                                    {% if order.order_status != 'pending' %}
                                                        <tr>
                                                            <td>#{{order.id}}</td> 
                                                            <td>{{order.product_name}}</td>
                                                            <td>{{order.cname}}</td>

                                                            <td>{{order.ratings}}</td>
                                                            <td>{{order.feedback}}</td>
                                                            <td>{{order.created_at}}</td>
                                                        
                                                            {% comment %} <td>{{order.quantity}}</td>
                                                            <td>{{order.destination}}</td>
                                                            <td>{{order.order_status}}</td> {% endcomment %}
                                                        </tr>
                                                        {% endif %}

                                                {% endfor %}
                                            {% else %}
                                                <p class='text-center p-2'>No orders yet</p>
                                            {% endif%}
                                        </table>
                                    </div>
    
                                </div>
                            </div>
                        </div>
                    </div>

                    

                    
                    


                </div> <!-- container-fluid -->


                <script src="{% static 'libs/echarts/echarts.min.js' %}"></script>

                <script src="{% static 'libs/apexcharts/apexcharts.min.js' %}"></script>


            <script>

                // Dummy data for vehicle capacity and load delivered
                var vehicleCapacity = [{% for truck_id, data in truck_loads.items %}'{{ data.capacity }}',{%endfor%}]; // Vehicle capacities in kg
                var loadDelivered = [{% for truck_id, data in truck_loads.items %}'{{ data.total_load }}',{%endfor%}]; // Actual loads delivered in kg

                // Calculate Load Efficiency as a percentage
                {% comment %} var loadEfficiency = loadDelivered.map((delivered, index) => ((delivered / vehicleCapacity[index]) * 100).toFixed(2));  {% endcomment %}
                var loadEfficiency = [{% for truck_id, data in truck_loads.items %}'{{ data.load_efficiency }}',{%endfor%}];

                

                var options = {
                    chart: {
                        height: 500,
                        type: "bar",
                        stacked: true,  // Enable stacked bars
                        toolbar: { show: false }
                    },
                    plotOptions: {
                        bar: {
                            horizontal: false,
                            barHeight: '60px'
                        }
                    },
                    dataLabels: { enabled: false },
                    series: [
                        {
                            name: 'Load Efficiency (%) ',  // Series for load efficiency
                            data: loadEfficiency  // Dummy data for load efficiency
                        },
                        {
                            name: 'Truck Load Capacity (kg)',  // Series for vehicle capacity
                            data: vehicleCapacity  // Dummy data for vehicle capacity
                        },
                        {
                            name: 'Load Delivered (kg)',  // Series for load delivered
                            data: loadDelivered  // Dummy data for load delivered
                        }
                    ],
                    colors: ["#FF4560", "#008FFB", "#00E396"],  // Colors for the three series
                    grid: { borderColor: "#e7e7e7" },
                    xaxis: {
                        categories: [

                        {% for truck_id, data in truck_loads.items %}'{{ data.truck_name }}',{%endfor%}
                        ],
                        title: {
                            text: 'Trucks'
                        }
                    },
                    yaxis: [{
                        title: {
                            text: 'Load Efficiency (%)'  // Updated title to reflect percentage
                        },
                        labels: {
                            formatter: function (val) {
                                return val + "%";  // Display as percentage
                            }
                        },
                        min: 0,
                        max: 100,  // Set max to 100 for percentage
                        tickAmount: 5,
                        position: 'left' // Positioning for Load Efficiency
                    }, {
                        opposite: true,
                        title: {
                            text: 'Load (kg)'
                        },
                        min: 0,
                        tickAmount: 5
                    }],
                    tooltip: {
                        y: {
                            formatter: function (val) {
                                if (this.seriesIndex === 0) {
                                    return val + "%"; // Load Efficiency tooltip
                                } else {
                                    return val + " ";  // Load Delivered and Vehicle Capacity tooltip
                                }
                            }
                        }
                    }
                };

                var chart = new ApexCharts(document.querySelector("#bar_chartEffe"), options);
                chart.render();







    var options = {
        chart: {
            height: 500,
            type: "bar",
            stacked: true,  // Enable stacked bars
            toolbar: { show: false }
        },
        plotOptions: {
            bar: {
                horizontal: true,
                barHeight: '60px'
            }
        },
        dataLabels: { enabled: false },
        series: [
        {
            name: 'All Orders',  // Series for delivered orders
            data: [{%for i in trucks%}'{{i.total_deliveries}}',{%endfor%}]  // Example data for delivered orders
        },
            {
                name: 'On Time Orders',  // Series for all orders
                data: [{%for i in trucks%}'{{i.on_time_deliveries}}',{%endfor%}]  // Example data for total orders
            },
            {
                name: 'Delay Orders',  // Series for delivered orders
                data: [{%for i in trucks%}'{{i.late_deliveries}}',{%endfor%}]  // Example data for delivered orders
            },
           
        ],
        colors: ["#f8c471","#ea8a2a", "#f46a6a"],  // Two colors: one for all orders, one for delivered
        grid: { borderColor: "#18603e" },
        xaxis: {
            categories: [
                {%for i in trucks%}'{{i.truck_name}}',{%endfor%}
            ],
        },
        tooltip: {
            y: {
                formatter: function (val) {
                    return val + " orders";  // Custom tooltip text for both series
                }
            }
        }
    };

    var chart = new ApexCharts(document.querySelector("#bar_chart"), options);
    chart.render();


    var options = {
        chart: {
            height: 500,
            type: "bar",
            toolbar: { show: false }
        },
        plotOptions: {
            bar: {
                horizontal: false,
                columnWidth: "45%",
                endingShape: "rounded"
            }
        },
        dataLabels: { enabled: false },
        stroke: {
            show: true,
            width: 2,
            colors: ["transparent"]
        },
        series: [
            { name: "Kilometre", data: [{% for i in trucks %}{{ i.driver_travel|floatformat:2 }},{% endfor %}] },  // Kilometre values rounded to 2 decimals
            { name: "Fuel Consumption(litre)", data: [{% for i in trucks %}{{ i.fuel|floatformat:2 }},{% endfor %}] }, // Fuel Consumption(litre) values rounded
            { name: "Delivered Load(Kg)", data: [{% for i in trucks %}{{ i.deleverd_load|floatformat:2 }},{% endfor %}] } // Delivered Load(Kg) values rounded
        ],
        colors: ["#1d4f6a", "#f46a6a", "#f8c471"], // Colors for the series
        xaxis: {
            categories: [{% for i in trucks %}'{{ i.truck_name }}',{% endfor %}]
        },
        yaxis: {
            title: { text: "Value", style: { fontWeight: "500" } } // General title
        },
        grid: { borderColor: "#f1f1f1" },
        fill: { opacity: 1 },
        tooltip: {
            shared: true,
            intersect: false,
            y: {
                formatter: function (value, { seriesIndex }) {
                    let unit = "";
                    switch (seriesIndex) {
                        case 0: unit = "km"; break;               // Kilometre
                        case 1: unit = "litres"; break;           // Fuel Consumption
                        case 2: unit = "kg"; break;               // Delivered Load
                    }
                    return `${value.toFixed(2)} ${unit}`;
                }
            }
        }
    };
    
    var chart = new ApexCharts(document.querySelector("#column_chart"), options);
    chart.render();
    
    
    


        // Function to create a gauge chart
       function createGaugeChart(elementId, title, value) {
        var dom = document.getElementById(elementId);
        dom.style.height = '350px'; // Set height of the chart

        var myChart = echarts.init(dom);
        var option = {
            tooltip: {
                formatter: "{a} <br/>{b} : {c}"
            },
            toolbox: {
                feature: false,
            },
            series: [{
                name: title,
                startAngle: 180,
                endAngle: 0,
                radius: '85%',
                type: "gauge",
                detail: {
                    formatter: "{value}",
                    offsetCenter: [0, '30%'], // Move detail text down
                    textStyle: {
                        fontSize: 20,
                        fontWeight: 'bold',
                        color: '#000'
                    }
                },
                axisLine: {
                    lineStyle: {
                        // Green for 0-90%, Yellow for 90-95%, Red for 95-100%
                        color: [[0.9, "#19aac2"], [0.95, "#f8c471"], [1, "#f46a6a"]],
                        width: 60
                    }
                },
                splitLine: {
                    show: true,
                    length: 15,
                    lineStyle: {
                        color: '#000',
                        width: 2
                    }
                },
                axisTick: {
                    show: true,
                    splitNumber: 5,
                    length: 8,
                    lineStyle: {
                        color: '#000'
                    }
                },
                axisLabel: {
                    show: true,
                    formatter: function (value) {
                        if (value % 20 === 0) {
                            return value;
                        }
                        return '';
                    },
                    textStyle: {
                        color: '#000',
                        fontSize: 12
                    }
                },
                pointer: {
                    itemStyle: {
                        color: "#556ee6"
                    }
                },
                title: {
                    show: true,
                    offsetCenter: [0, '60%'], 
                    textStyle: {
                        fontSize: 10,
                        fontWeight: 'bold',
                        color: '#000'
                    }
                },
                data: [{ value: value, name: "" }]
            }]
        };

        // Update the chart periodically
        setInterval(function () {
            myChart.setOption(option, true);
        }, 2000);

        myChart.setOption(option, true);
    }

    // Create different gauge charts with unique values
    createGaugeChart("gauge-chart", "CO2 emission reductions in kilograms", {{all_co2_emission_reduction}});
    createGaugeChart("gauge-chart1", "Fuel Consumption(litre)",{{all_fuel_consumption}} ); // Example value
    createGaugeChart("gauge-chart2", "Fuel Savings(litre)", {{all_fuel_savings}}); // Example value




        var options = {
            series: [{{within_time}},{{out_of_time}}], // Data for the donut chart
            chart: {
                type: "donut", // Chart type
                height: 350 // Height of the chart
            },
            labels: ["Within Time", "Out Of Time"], // Labels for each section of the donut chart
            colors: ["#34c38f", "#f46a6a"], // Colors for each section of the chart
            legend: {
                show: false // Hides the legend
            },
            plotOptions: {
                pie: {
                    donut: {
                        size: "50%" // Size of the donut hole
                    }
                }
            }
        };

        // Creating and rendering the donut chart
        var chart = new ApexCharts(document.querySelector("#donut-chart"), options);
        chart.render();


        function alertSelectedValue() {

            var selectElement = document.getElementById("warehouseSelect");
            var selectedValue = selectElement.value;

            var selectstart = document.getElementById("start").value;
            var selectend = document.getElementById("end").value;

            var selectorderstart = document.getElementById("order_startdate").value;
            var selectorderend = document.getElementById("order_enddate").value;

            var selectorder = document.getElementById("order_status");
            var selectedValueo = selectorder.value;

        
            $.ajax({
                type: "POST",
                url: "{% url 'reports' %}",
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    wids: selectedValue ,
                    strat_date:selectstart,
                    end_date:selectend,
                    selectedValueo:selectedValueo,
                    selectorderstart:selectorderstart,
                    selectorderend:selectorderend,
                },
                success: function(response) {
                    console.log(response,"1");

                    if (response.status === 'SENT') {
                        console.log(response.trucks, "truckstruckstrucks");
                        document.getElementById("warehouse_total_order").textContent = response.warehouse_total_order;
                        document.getElementById("warehouse_pending_order").textContent = response.warehouse_pending_order;
                        document.getElementById("warehouse_complete_order").textContent = response.warehouse_complete_order;
                        document.getElementById("within_time").textContent = response.within_time; 
                        document.getElementById("out_of_time").textContent = response.out_of_time; 
                        chart.updateSeries([response.within_time, response.out_of_time]);


                        const warehouseTableBody = document.getElementById('warehouseTableBody');
                        warehouseTableBody.innerHTML = '';
                        if (response.warehouse_list) {
                                response.warehouse_list.forEach((warehouse, index) => {
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                        <th scope="row">${index + 1}</th>
                                        <td>${warehouse.name}</td>
                                        <td>${warehouse.total_stock}</td>
                                        <td>${warehouse.available_stock}</td>
                                        <td>${warehouse.left_stock}</td>
                                    `;
                                    warehouseTableBody.appendChild(row);
                                });
                                console.log(response.warehouse_list, "warehouse");

                        }

                        
                        const feedbackBody = document.getElementById('feedback-body');
                        feedbackBody.innerHTML = ''; // Clear any existing content

                        if (response.feedback_list) {
                            console.log(response.feedback_list,"response.feedback_listresponse.feedback_list")
                        
                                response.feedback_list.forEach(feedback => {
                                    const row = document.createElement('tr');
                            
                                    const orderCell = document.createElement('th');
                                    orderCell.setAttribute('scope', 'row');
                                    orderCell.textContent = feedback.id;
                            
                                    const nameCell = document.createElement('td');
                                    nameCell.textContent = feedback.order__cname;
                            
                                    const ratingCell = document.createElement('td');
                                    const badge = document.createElement('span');
                                    badge.className = 'badge badge-pill font-size-11 text-capitalize badge-soft-success';
                                    badge.textContent = feedback.rating_text;
                                    ratingCell.appendChild(badge);
                            
                                    const descriptionCell = document.createElement('td');
                                    descriptionCell.textContent = feedback.description;
                            
                                    row.appendChild(orderCell);
                                    row.appendChild(nameCell);
                                    row.appendChild(ratingCell);
                                    row.appendChild(descriptionCell);
                            
                                    feedbackBody.appendChild(row);
                                });
                        }

                        const orderBody = document.getElementById('order_list');
                        orderBody.innerHTML = '';
                        if (response.order_list) {
                            response.order_list.forEach((order, index) => {
                                // Create a new row
                                const row = document.createElement('tr');
                        
                                // Create and populate cells
                                const srNoCell = document.createElement('td');
                                srNoCell.textContent = index + 1; // Serial number
                        
                                const productNameCell = document.createElement('td');
                                productNameCell.textContent = order.product_name;
                        
                                const customerCell = document.createElement('td');
                                customerCell.textContent = order.cname;
                        
                                const qtyCell = document.createElement('td');
                                qtyCell.textContent = order.quantity;
                        
                                const destinationCell = document.createElement('td');
                                destinationCell.textContent = order.destination;

                                const statusCell = document.createElement('td');
                                statusCell.textContent = order.order_status;
                        
                                
                                // Append cells to the row
                                row.appendChild(srNoCell);
                                row.appendChild(productNameCell);
                                row.appendChild(customerCell);
                                row.appendChild(qtyCell);
                                row.appendChild(destinationCell);
                                row.appendChild(statusCell);
                        
                                // Append the row to the order body
                                orderBody.appendChild(row);
                            });
                        }


                        if (response.trucks) {
                            const truckData = response.trucks.map(truck => truck.order_count);
                            updateBarChart(truckData); // Update bar chart with new truck data
                        }

                        
                    } else {
                        console.error("Unexpected status:", response.status);
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error:", error);
                }
            });
        }

        {% comment %} window.onload = function() {
            alertSelectedValue();
        }; {% endcomment %}
    </script>

                



    {% endblock %}